# ProjectBank1

## Описание
Это учебный проект виджета для банка. Реализованы функции для маскировки банковских карт, фильтрации транзакций по статусу и работы с датами.
## Структура 

```plaintext
├── src/                  # Основные исходные файлы
│   ├──__init__.py
│   ├── widget.py         # Функции маскировки и работы с датами
│   ├── external_api.py   # Функции для конвертации в рубли
│   ├── generators.py     # Функции генерирующая номера карт и описание транзакций по очереди
│   ├── masks.py          # Функции маскирующая данные
│   ├── processing.py     # Функции фильтрации транзакций
│   ├── utils.py          # Функции читает JSON-файл
│   ├── utils_cvs_excel.py# Функции читает cvs и excel -файлы
│   ├── widget.py         # Функции маскировки и работы с датами
├── tests/                # Тесты проекта
├── main.py               # Точка входа в приложение
├── poetry.lock           # Файл блокировки зависимостей
├── pyproject.toml        # Конфигурация проекта для Poetry
```

## Установка
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/anakin0105/homework_course2.git
Перейдите в папку проекта:
bash
Copy
cd homework_course2
Убедитесь, что у вас установлен Python (например, версии 3.10+).
Установите зависимости:
bash
Copy
poetry install
## Использование
Чтобы запустить проект, используйте:
Запустить модуль main.py
## Лицензия
Этот проект распространяется под лицензией MIT. Подробнее см. [LICENSE](./LICENSE).


### Как запустить тесты?

1. Убедитесь, что все зависимости установлены:
   ```bash
   pip install -r requirements.txt
   # Проект: Рабочие инструменты и генераторы

## Основные возможности
1. **Функции обработки данных**:
   - Реализованы функции для фильтрации и выбора данных.
   - Добавлены аннотации типов для повышения читаемости и проверки кода.

2. **Работа с генераторами**:
   - Генераторы позволяют обрабатывать данные "на лету", не загружая их полностью в память.


----



##  Генераторы

### 1. Генератор `filter_by_currency`
Генератор для фильтрации списка транзакций по валюте.

**Пример использования:**
```python
transactions = [
    {"id": 1, "operationAmount": {"currency": {"code": "USD"}}},
    {"id": 2, "operationAmount": {"currency": {"code": "EUR"}}},
    {"id": 3, "operationAmount": {"currency": {"code": "USD"}}}
]

for transaction in filter_by_currency(transactions, "USD"):
    print(transaction)
## Декоратор log

Файл: `decorators/log_decorator.py`

Декоратор `log` автоматически логирует выполнение функций.  
Он фиксирует время вызова функции, переданные аргументы, результат её выполнения или ошибки.  

Примеры использования:

### Логирование в файл
```python
from decorators.log_decorator import log

@log(filename="app.log")
def add(a, b):
    return a + b

add(1, 2)  # Логи будут добавлены в файл app.log.
```
## Описание
Проект предоставляет утилиты для работы с данными о транзакциях: чтение из файлов различных форматов (JSON, CSV, Excel), обработка, фильтрация, сортировка и конвертация сумм в рубли. Реализованы функции для обработки данных, добавлен декоратор для логирования вызовов функций, а также тесты для проверки функциональности.

## Функциональность

### Декоратор для логирования
Добавлен декоратор для логирования работы функций, который записывает информацию о вызове функций и их результатах.

- **Параметр**: `filename` — имя файла, в который записываются логи. Если `filename=None`, логи выводятся в консоль.
- **Возвращает**: Декорированную функцию, которая выполняет логирование вызовов.

Пример использования:
```python
from utils import log_decorator

@log_decorator(filename="log.txt")
def some_function():
    pass
```

### Модули и функции

#### 1. Модуль `external_api.py`
- **Функция**: `convert_to_rub`
  - **Описание**: Конвертирует сумму из указанной валюты в рубли, используя внешний API (например, для получения курса валют).
  - **Параметры**:
    - `amount` — сумма для конвертации.
    - `currency` — валюта исходной суммы (например, "USD", "EUR").
  - **Возвращает**: Сумму в рублях (тип `float`).

#### 2. Модуль `processing.py`
- **Функция**: `filter_by_state`
  - **Описание**: Фильтрует список словарей, оставляя только элементы с указанным значением ключа `"state"`.
  - **Параметры**:
    - `transactions` — список словарей с данными о транзакциях.
    - `state` — значение ключа `"state"` для фильтрации (например, "EXECUTED", "CANCELED").
  - **Возвращает**: Отфильтрованный список словарей.

- **Функция**: `sort_by_date`
  - **Описание**: Сортирует список словарей по ключу `"date"` в порядке возрастания или убывания.
  - **Параметры**:
    - `transactions` — список словарей с данными о транзакциях.
    - `reverse` — если `True`, сортировка по убыванию; если `False`, по возрастанию (по умолчанию `False`).
  - **Возвращает**: Отсортированный список словарей.

#### 3. Модуль `utils.py`
- **Функция**: `read_transactions_json`
  - **Описание**: Читает JSON-файл и возвращает список словарей с данными о транзакциях.
  - **Параметры**:
    - `file_path` — путь к JSON-файлу.
  - **Возвращает**: Список словарей с данными о транзакциях.

#### 4. Модуль `utils_csv_excel.py`
- **Функция**: `get_read_csv`
  - **Описание**: Считывает транзакции из файла `.csv` и возвращает список словарей.
  - **Параметры**:
    - `file_path` — путь к CSV-файлу.
  - **Возвращает**: Список словарей с данными о транзакциях.

- **Функция**: `get_read_excel`
  - **Описание**: Считывает транзакции из файла `.xlsx` и возвращает список словарей.
  - **Параметры**:
    - `file_path` — путь к Excel-файлу.
  - **Возвращает**: Список словарей с данными о транзакциях.

## Тестирование
- Все функции покрыты тестами с использованием `pytest`.
- Для проверки покрытия тестами используйте команду:
  ```bash
  pytest --cov=. --cov-report=html
  ```
- HTML-отчёт о покрытии будет сгенерирован в папке `htmlcov`. Откройте `htmlcov/index.html` в браузере, чтобы увидеть процент покрытия и непокрытые строки.

## Логирование
- Все функции используют декоратор логирования для записи информации о вызовах и результатах.
- Логи по умолчанию записываются в файл (если указан `filename`) или выводятся в консоль.
