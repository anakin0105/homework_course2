# ProjectBank1

## Описание
Это учебный проект виджета для банка. Реализованы функции для маскировки банковских карт, фильтрации транзакций по статусу и работы с датами.
## Структура 

```plaintext
├── src/                  # Основные исходные файлы
│   ├──__init__.py
│   ├── decorators.py     # Декоратор для логирования работы функций.
│   ├── external_api.py   # Функции для конвертации в рубли
│   ├── generators.py     # Функции генерирующая номера карт и описание транзакций по очереди
│   ├── masks.py          # Функции маскирующая данные
│   ├── processing.py     # Функции фильтрации транзакций
│   ├── search.py         # Функции поска по JSON cvs и excel - файла
│   ├── utils.py          # Функции читает JSON-файл
│   ├── utils_cvs_excel.py# Функции читает cvs и excel -файлы
│   ├── widget.py         # Функции маскировки и работы с датами
├── tests/                # Тесты проекта
├── main.py               # Точка входа в приложение
├── poetry.lock           # Файл блокировки зависимостей
├── pyproject.toml        # Конфигурация проекта для Poetry
```

### Модули и функции
#### 1 . Модуль `decorators.py`
- **Функция**: `log`
  - **Описание**: Декоратор для логирования работы функций. Логи могут быть записаны в указанный файл или выведены на консоль.
  - **Параметры**:
    - `filename` — имя файла, в который записываются логи. Если None, вывод идет в консоль.
  - **Возвращает**: декорированную функцию, которая регистрирует вызовы и результаты выполнения целевой функции.

#### 2 . Модуль `external_api.py`
- **Функция**: `convert_to_rub`
  - **Описание**: Конвертирует сумму из указанной валюты в рубли, используя внешний API (например, для получения курса валют).
  - **Параметры**:
    - `amount` — сумма для конвертации.
    - `currency` — валюта исходной суммы (например, "USD", "EUR").
  - **Возвращает**: Сумму в рублях (тип `float`).


#### 3 . Модуль `generators.py`
- **Функция**: `filter_by_currency`
  - **Описание**: Фильтрует транзакции по указанной валюте, извлекая код валюты из вложенного словаря operationAmount.currency.code. Возвращает генератор, который выдает транзакции, соответствующие заданной валюте.
  - **Параметры**:
    - `transactions` — список словарей, представляющих транзакции.
    - `currency` — строковый код валюты (например, «USD», «RUB»), по которому выполняется фильтрация.
  - **Возвращает**: генератор, возвращающий словари транзакций, соответствующие указанной валюте. Если у транзакции отсутствует информация о валюте (operationAmount.currency.code равно None), выводит сообщение в консоль.

- **Функция**: `filter_by_currency_csv_excel`
  - **Описание**:  Фильтрует транзакции по указанной валюте, извлекая код валюты из поля currency_code (используется для данных из CSV/Excel). Возвращает генератор, который выдает транзакции, соответствующие заданной валюте.
  - **Параметры**:
    - `transactions` — список словарей, представляющих транзакции.
    - `currency` — строковый код валюты (например, «USD», «RUB»), по которому выполняется фильтрация.
  - **Возвращает**: генератор, возвращающий словари транзакций, соответствующие указанной валюте. Если у транзакции отсутствует информация о валюте (currency_code равно None), выводит сообщение в консоль.

- **Функция**: `transaction_descriptions`
  - **Описание**:  Генератор, который извлекает и возвращает описания транзакций из списка словарей.
  - **Параметры**:
    - `transactions` — список словарей, каждый из которых представляет транзакцию и может содержать поле "description".
    - `currency` — строковый код валюты (например, «USD», «RUB»), по которому выполняется фильтрация.
  - **Возвращает**: генератор, выдающий строки с описанием каждой транзакции, если они присутствуют.


- **Функция**: `card_number_generator`
  - **Описание**:  генерирует последовательные номера банковских карт в отформатированном виде (16 цифр с пробелами через каждые 4 цифры).
  - **Параметры**:
    - `start` — начальное целое число для генерации номера карты (по умолчанию 1).
    - `end` — конечное целое число для генерации номера карты (по умолчанию 10^16 — 1).
  - **Возвращает**: генератор, выдающий номера карт в виде строк, отформатированных с пробелами (например, «0000 0000 0000 0001»).


#### 4. Модуль `masks.py`

- **Функция**: `get_mask_card_number`
  - **Описание**:  маскирует номер банковской карты по правилу XXXX XX** **** XXXX. Номер должен состоять из 16 цифр.
  - **Параметры**:
    - `card_number` — номер банковской карты в виде строки.
  - **Возвращает**: замаскированный номер карты в строковом формате. Если входные данные некорректны (не 16 цифр), возвращает сообщение об ошибке.

- **Функция**: ` get_mask_account`
  - **Описание**:  маскирует номер банковского счета, оставляя видимыми только последние 4 цифры (**XXXX). Номер должен состоять из 20 цифр.
  - **Параметры**:
    - `account_number` — номер банковского счёта в виде строки.
  - **Возвращает**: амаскированный номер счета в строковом формате. Если входные данные некорректны (не 20 цифр или другие ошибки), возвращает сообщение об ошибке.

#### 5. Модуль `processing.py`
- **Функция**: `filter_by_state`
  - **Описание**: Фильтрует список словарей, оставляя только элементы с указанным значением ключа `"state"`.
  - **Параметры**:
    - `transactions` — список словарей с данными о транзакциях.
    - `state` — значение ключа `"state"` для фильтрации (например, "EXECUTED", "CANCELED").
  - **Возвращает**: Отфильтрованный список словарей.

- **Функция**: `sort_by_date`
  - **Описание**: Сортирует список словарей по ключу `"date"` в порядке возрастания или убывания.
  - **Параметры**:
    - `transactions` — список словарей с данными о транзакциях.
    - `reverse` — если `True`, сортировка по убыванию; если `False`, по возрастанию (по умолчанию `False`).
  - **Возвращает**: Отсортированный список словарей.

#### 6. Модуль `search.py`

- **Функция**: `process_bank_search`
  - **Описание**: Фильтрует список банковских операций, оставляя только те, в описании которых содержится заданная строка поиска (без учёта регистра).
  - **Параметры**:
    - `data` —  список словарей, каждый из которых представляет банковскую операцию и может содержать ключ 'description'.
    - `search` — строка, по которой выполняется поиск в описаниях операций.
  - **Возвращает**: новый список словарей, содержащий только те операции, описание которых соответствует строке поиска.

- **Функция**: `process_bank_operations`
  - **Описание**: Подсчитывает количество операций для каждой указанной категории на основе их описаний.
  - **Параметры**:
    - `data` —  список словарей, каждый из которых представляет банковскую операцию и может содержать ключ 'description'.
    - `categories` — список строк, представляющих категории, по которым необходимо произвести подсчёт.
  - **Возвращает**: словарь, где ключами являются категории, а значениями — количество операций, соответствующих этим категориям.

- **Функция**: `process_bank_operations_count`
  - **Описание**: Подсчитывает количество вхождений описаний транзакций и обновляет предоставленный словарь подсчётов.
  - **Параметры**:
    - `data` — список словарей, представляющих транзакции, каждая из которых может содержать ключ 'description'.
    - `count_dict` — словарь, в который будут записаны результаты подсчёта. Ключи этого словаря должны соответствовать описаниям транзакций.
  - **Возвращает**: обновленный словарь count_dict с подсчитанным количеством операций по соответствующим описаниям.

#### 7. Модуль `utils.py`
- **Функция**: `read_transactions_json`
  - **Описание**: Читает JSON-файл и возвращает список словарей с данными о транзакциях.
  - **Параметры**:
    - `file_path` — путь к JSON-файлу.
  - **Возвращает**: Список словарей с данными о транзакциях.

#### 8. Модуль `utils_csv_excel.py`
- **Функция**: `get_read_csv`
  - **Описание**: Считывает транзакции из файла `.csv` и возвращает список словарей.
  - **Параметры**:
    - `file_path` — путь к CSV-файлу.
  - **Возвращает**: Список словарей с данными о транзакциях.

- **Функция**: `get_read_excel`
  - **Описание**: Считывает транзакции из файла `.xlsx` и возвращает список словарей.
  - **Параметры**:
    - `file_path` — путь к Excel-файлу.
  - **Возвращает**: Список словарей с данными о транзакциях.

#### 9. Модуль `widget.py`
- **Функция**: `mask_account_card`
  - **Описание**: маскирует номер банковской карты или счета, основываясь на длине предоставленной числовой части. Функция ожидает входную строку, состоящую из названия (например, «Карта» или «Счет») .
  - **Параметры**:
    - `data` — строка, содержащая название и номер карты/счета (например, «Карта 1234567890123456» или «Счет 12345678901234567890»).
  - **Возвращает**: строку, содержащую название и замаскированный номер карты или счета. Если формат входных данных некорректен или номер имеет неверную длину, возвращается соответствующее сообщение об ошибке.


- **Функция**: `get_date`
  - **Описание**: преобразует строковое представление даты и времени из формата YYYY-MM-DDTHH:MM:SS в формат ДД.ММ.ГГГГ.
  - **Параметры**:
    - `date_time` — строку с датой в формате ДД.ММ.ГГГГ. Если входная строка имеет некорректный формат, возвращает сообщение об ошибке.

## Установка
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/anakin0105/homework_course2.git
Перейдите в папку проекта:
bash
Copy
cd homework_course2
Убедитесь, что у вас установлен Python (например, версии 3.10+).
Установите зависимости:
bash
Copy
poetry install
## Использование
Чтобы запустить проект, используйте:
Запустить модуль main.py
## Лицензия
Этот проект распространяется под лицензией MIT. Подробнее см. [LICENSE](./LICENSE).


### Как запустить тесты?

1. Убедитесь, что все зависимости установлены:
   ```bash
   pip install -r requirements.txt
   # Проект: Рабочие инструменты и генераторы

## Основные возможности
1. **Функции обработки данных**:
   - Реализованы функции для фильтрации и выбора данных.
   - Добавлены аннотации типов для повышения читаемости и проверки кода.

2. **Работа с генераторами**:
   - Генераторы позволяют обрабатывать данные "на лету", не загружая их полностью в память.


----



##  Генераторы

### 1. Генератор `filter_by_currency`
Генератор для фильтрации списка транзакций по валюте.

**Пример использования:**
```python
transactions = [
    {"id": 1, "operationAmount": {"currency": {"code": "USD"}}},
    {"id": 2, "operationAmount": {"currency": {"code": "EUR"}}},
    {"id": 3, "operationAmount": {"currency": {"code": "USD"}}}
]

for transaction in filter_by_currency(transactions, "USD"):
    print(transaction)
## Декоратор log

Файл: `decorators/log_decorator.py`

Декоратор `log` автоматически логирует выполнение функций.  
Он фиксирует время вызова функции, переданные аргументы, результат её выполнения или ошибки.  

Примеры использования:

### Логирование в файл
```python
from decorators.log_decorator import log

@log(filename="app.log")
def add(a, b):
    return a + b

add(1, 2)  # Логи будут добавлены в файл app.log.
```
## Описание
Проект предоставляет утилиты для работы с данными о транзакциях: чтение из файлов различных форматов (JSON, CSV, Excel), обработка, фильтрация, сортировка и конвертация сумм в рубли. Реализованы функции для обработки данных, добавлен декоратор для логирования вызовов функций, а также тесты для проверки функциональности.

## Функциональность

### Декоратор для логирования
Добавлен декоратор для логирования работы функций, который записывает информацию о вызове функций и их результатах.

- **Параметр**: `filename` — имя файла, в который записываются логи. Если `filename=None`, логи выводятся в консоль.
- **Возвращает**: Декорированную функцию, которая выполняет логирование вызовов.

Пример использования:
```python
from utils import log_decorator

@log_decorator(filename="log.txt")
def some_function():
    pass
```

## Тестирование
- Все функции покрыты тестами с использованием `pytest`.
- Для проверки покрытия тестами используйте команду:
  ```bash
  pytest --cov=. --cov-report=html
  ```
- HTML-отчёт о покрытии будет сгенерирован в папке `htmlcov`. Откройте `htmlcov/index.html` в браузере, чтобы увидеть процент покрытия и непокрытые строки.

## Логирование
- Все функции используют декоратор логирования для записи информации о вызовах и результатах.
- Логи по умолчанию записываются в файл (если указан `filename`) или выводятся в консоль.
